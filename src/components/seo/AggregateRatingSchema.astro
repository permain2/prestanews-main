---
/**
 * Aggregate Rating Schema - Simple star ratings for articles
 * Shows star ratings and review count in Google search results
 */
import { SITE_URL } from '../../consts';

interface Props {
  itemName: string;
  itemType?: 'Article' | 'Product' | 'FinancialProduct' | 'CreditCard' | 'Service';
  rating?: number; // 1-5 scale, defaults to random 4.2-4.9
  reviewCount?: number; // Defaults to random 47-234
  url: string;
  image?: string;
  description?: string;
}

const {
  itemName,
  itemType = 'Article',
  rating,
  reviewCount,
  url,
  image,
  description,
} = Astro.props;

// Generate random rating between 4.2-4.9 if not provided (realistic range)
const actualRating = rating ?? (Math.random() * (4.9 - 4.2) + 4.2);
const roundedRating = Math.round(actualRating * 10) / 10;

// Generate random review count between 47-234 if not provided
const actualReviewCount = reviewCount ?? Math.floor(Math.random() * (234 - 47 + 1)) + 47;

const fullUrl = url.startsWith('http') ? url : `${SITE_URL}${url}`;
const imageUrl = image ? (image.startsWith('http') ? image : `${SITE_URL}${image}`) : null;

const schema = {
  "@context": "https://schema.org",
  "@type": itemType,
  "name": itemName,
  ...(description && { "description": description }),
  ...(imageUrl && { "image": imageUrl }),
  "url": fullUrl,
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": roundedRating.toFixed(1),
    "bestRating": "5",
    "worstRating": "1",
    "ratingCount": actualReviewCount,
    "reviewCount": actualReviewCount
  }
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
