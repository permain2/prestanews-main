<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Screened Admin - Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M9 9h6M9 13h6M9 17h4"/>
        </svg>
        <span>Screened</span>
      </div>
      <nav class="nav">
        <a href="/" class="nav-item active">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
          </svg>
          Dashboard
        </a>
        <a href="/editor" class="nav-item">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          New Article
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Header -->
      <header class="header">
        <div>
          <h1>Article Dashboard</h1>
          <p class="header-subtitle">Manage your 1000 keyword targets</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="location.href='/editor'">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            </svg>
            Form Editor
          </button>
          <button class="btn btn-primary" onclick="location.href='/visual-editor.html'">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Visual Editor
          </button>
        </div>
      </header>

      <!-- Stats Cards -->
      <div class="stats-grid" id="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="stat-total">--</div>
          <div class="stat-label">Total Keywords</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-not-started">--</div>
          <div class="stat-label">Not Started</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-in-progress">--</div>
          <div class="stat-label">In Progress</div>
        </div>
        <div class="stat-card stat-card-success">
          <div class="stat-value" id="stat-published">--</div>
          <div class="stat-label">Published</div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="search-box">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
          </svg>
          <input type="text" id="search-input" placeholder="Search keywords..." onkeyup="filterKeywords()">
        </div>
        <div class="filter-pills">
          <button class="pill active" data-filter="all" onclick="setFilter('all', this)">All</button>
          <button class="pill" data-filter="not_started" onclick="setFilter('not_started', this)">Not Started</button>
          <button class="pill" data-filter="draft" onclick="setFilter('draft', this)">Drafts</button>
          <button class="pill" data-filter="published" onclick="setFilter('published', this)">Published</button>
        </div>
        <select id="category-filter" class="select" onchange="filterKeywords()">
          <option value="">All Categories</option>
        </select>
      </div>

      <!-- Keywords Table -->
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Keyword</th>
              <th>Category</th>
              <th>Priority</th>
              <th>Search Vol.</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="keywords-table">
            <tr>
              <td colspan="6" class="loading">Loading keywords...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <script>
    // State
    let allKeywords = [];
    let currentFilter = 'all';

    // Load data on page load
    document.addEventListener('DOMContentLoaded', () => {
      loadStats();
      loadKeywords();
    });

    // Load stats
    async function loadStats() {
      try {
        const res = await fetch('/api/stats');
        const stats = await res.json();
        
        document.getElementById('stat-total').textContent = stats.totalKeywords;
        document.getElementById('stat-not-started').textContent = stats.notStarted;
        document.getElementById('stat-in-progress').textContent = stats.inProgress;
        document.getElementById('stat-published').textContent = stats.published;
        
        // Populate category filter
        const categorySelect = document.getElementById('category-filter');
        Object.keys(stats.byCategory).forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = `${cat} (${stats.byCategory[cat].published}/${stats.byCategory[cat].total})`;
          categorySelect.appendChild(option);
        });
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    // Load keywords
    async function loadKeywords() {
      try {
        const res = await fetch('/api/keywords');
        const data = await res.json();
        allKeywords = data.keywords;
        renderKeywords(allKeywords);
      } catch (error) {
        console.error('Failed to load keywords:', error);
        document.getElementById('keywords-table').innerHTML = `
          <tr><td colspan="6" class="error">Failed to load keywords. Is the server running?</td></tr>
        `;
      }
    }

    // Render keywords table
    function renderKeywords(keywords) {
      const tbody = document.getElementById('keywords-table');
      
      if (keywords.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty">No keywords found</td></tr>';
        return;
      }

      tbody.innerHTML = keywords.map(k => `
        <tr class="keyword-row" onclick="editArticle('${k.slug}')">
          <td>
            <div class="keyword-name">${k.keyword}</div>
            <div class="keyword-slug">${k.slug}</div>
          </td>
          <td><span class="category-badge category-${k.category}">${k.category}</span></td>
          <td><span class="priority priority-${k.priority}">P${k.priority}</span></td>
          <td>${formatNumber(k.search_volume)}</td>
          <td><span class="status status-${k.status || 'not_started'}">${formatStatus(k.status)}</span></td>
          <td>
            <div class="actions">
              <button class="btn-icon" onclick="event.stopPropagation(); editArticle('${k.slug}')" title="Edit">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
              </button>
              ${k.status === 'published' ? `
                <a class="btn-icon" href="/${k.category}/${k.slug}" target="_blank" onclick="event.stopPropagation()" title="View Live">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                    <polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>
                  </svg>
                </a>
              ` : ''}
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Filter keywords
    function filterKeywords() {
      const search = document.getElementById('search-input').value.toLowerCase();
      const category = document.getElementById('category-filter').value;
      
      let filtered = allKeywords;
      
      // Filter by status
      if (currentFilter !== 'all') {
        filtered = filtered.filter(k => {
          const status = k.status || 'not_started';
          if (currentFilter === 'draft') {
            return status === 'draft' || status === 'in_progress';
          }
          return status === currentFilter;
        });
      }
      
      // Filter by category
      if (category) {
        filtered = filtered.filter(k => k.category === category);
      }
      
      // Filter by search
      if (search) {
        filtered = filtered.filter(k => 
          k.keyword.toLowerCase().includes(search) ||
          k.slug.toLowerCase().includes(search)
        );
      }
      
      renderKeywords(filtered);
    }

    // Set status filter
    function setFilter(filter, btn) {
      currentFilter = filter;
      document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      filterKeywords();
    }

    // Navigate to visual editor
    function editArticle(slug) {
      window.location.href = `/visual-editor.html?slug=${slug}`;
    }

    // Format helpers
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num;
    }

    function formatStatus(status) {
      const labels = {
        'not_started': 'Not Started',
        'draft': 'Draft',
        'in_progress': 'In Progress',
        'published': 'Published'
      };
      return labels[status] || 'Not Started';
    }
  </script>
</body>
</html>

